---
title: "Final Project"
author: "David Esposto"
date: "2022-11-22"
output: html_document
---

```{r}
set.seed(99)
mushroomData = read.csv("mushroom.csv", sep = ';')
head(mushroomData)

library (rpart)

num_samples = dim(mushroomData)[1]
sampling.rate = 0.1
training = sample(1:num_samples, sampling.rate*num_samples, replace= FALSE)
trainingSet = subset(mushroomData[training, ])
testing = setdiff(1:num_samples,training)
testingSet = subset(mushroomData[testing, ])

decTreeModel = rpart(class~cap.diameter+cap.shape+cap.surface+cap.color+does.bruise.or.bleed+gill.attachment+gill.spacing+gill.color+stem.height+stem.width+stem.root+stem.surface+stem.color+has.ring+ring.type+spore.print.color+habitat+season,data=trainingSet)

plot(decTreeModel, margin=0.1)
text(decTreeModel)

plotcp(decTreeModel)

pruned_decTreeModel = prune(decTreeModel, cp=0.02)
plot (pruned_decTreeModel, margin=0.1)
text (pruned_decTreeModel)

predictedLabelsPrune = predict(pruned_decTreeModel, testingSet, type="class")
sizeTestSet = dim(testingSet) [1]
errorTree = sum(predictedLabelsPrune != testingSet$class)
misclassification_rateTree = errorTree/sizeTestSet
```

```{r}
mushroomDataRF = read.csv("mushroom.csv", sep = ';')
head(mushroomDataRF)

library (rpart)

mushroomDataRF$class <- as.factor(mushroomDataRF$class)
mushroomDataRF$cap.shape <- as.numeric(as.factor(mushroomDataRF$cap.shape))
mushroomDataRF$cap.surface <- as.numeric(as.factor(mushroomDataRF$cap.surface))
mushroomDataRF$cap.color <- as.numeric(as.factor(mushroomDataRF$cap.color))
mushroomDataRF$does.bruise.or.bleed <- as.numeric(as.factor(mushroomDataRF$does.bruise.or.bleed))
mushroomDataRF$gill.attachment <- as.numeric(as.factor(mushroomDataRF$gill.attachment))
mushroomDataRF$gill.spacing <- as.numeric(as.factor(mushroomDataRF$gill.spacing))
mushroomDataRF$gill.color <- as.numeric(as.factor(mushroomDataRF$gill.color))
mushroomDataRF$stem.root <- as.numeric(as.factor(mushroomDataRF$stem.root))
mushroomDataRF$stem.surface <- as.numeric(as.factor(mushroomDataRF$stem.surface))
mushroomDataRF$stem.color <- as.numeric(as.factor(mushroomDataRF$stem.color))
mushroomDataRF$veil.type <- as.numeric(as.factor(mushroomDataRF$veil.type))
mushroomDataRF$veil.color <- as.numeric(as.factor(mushroomDataRF$veil.color))
mushroomDataRF$has.ring <- as.numeric(as.factor(mushroomDataRF$has.ring))
mushroomDataRF$ring.type <- as.numeric(as.factor(mushroomDataRF$ring.type))
mushroomDataRF$spore.print.color <- as.numeric(as.factor(mushroomDataRF$spore.print.color))
mushroomDataRF$habitat <- as.numeric(as.factor(mushroomDataRF$habitat))
mushroomDataRF$season <- as.numeric(as.factor(mushroomDataRF$season))

num_samples = dim(mushroomDataRF)[1]
sampling.rate = 0.1
training = sample(1:num_samples, sampling.rate*num_samples, replace= FALSE)
trainingSet = subset(mushroomDataRF[training, ])
testing = setdiff(1:num_samples,training)
testingSet = subset(mushroomDataRF[testing, ])

library(randomForest)

RandForestModel <- randomForest(class~.,data=trainingSet, ntree=100) 
plot(RandForestModel)
RandForestModel$err.rate

predictedLabels = predict(RandForestModel, testingSet, type ="class")
sizeTestSetRF = dim(testingSet)[1]
errorRF = sum(predictedLabels!=testingSet$class)
misclassRF = errorRF/sizeTestSetRF

IsE = (predictedLabels == 'e')
IsWrongAndE = (IsE & errorRF)
errorE = sum(IsWrongAndE)
```

```{r}
library(class)
mushroomDataKNN = read.csv("mushroom.csv", sep = ';')

mushroomDataKNN$cap.shape <- as.numeric(as.factor(mushroomDataKNN$cap.shape))
mushroomDataKNN$cap.surface <- as.numeric(as.factor(mushroomDataKNN$cap.surface))
mushroomDataKNN$cap.color <- as.numeric(as.factor(mushroomDataKNN$cap.color))
mushroomDataKNN$does.bruise.or.bleed <- as.numeric(as.factor(mushroomDataKNN$does.bruise.or.bleed))
mushroomDataKNN$gill.attachment <- as.numeric(as.factor(mushroomDataKNN$gill.attachment))
mushroomDataKNN$gill.spacing <- as.numeric(as.factor(mushroomDataKNN$gill.spacing))
mushroomDataKNN$gill.color <- as.numeric(as.factor(mushroomDataKNN$gill.color))
mushroomDataKNN$stem.root <- as.numeric(as.factor(mushroomDataKNN$stem.root))
mushroomDataKNN$stem.surface <- as.numeric(as.factor(mushroomDataKNN$stem.surface))
mushroomDataKNN$stem.color <- as.numeric(as.factor(mushroomDataKNN$stem.color))
mushroomDataKNN$veil.type <- as.numeric(as.factor(mushroomDataKNN$veil.type))
mushroomDataKNN$veil.color <- as.numeric(as.factor(mushroomDataKNN$veil.color))
mushroomDataKNN$has.ring <- as.numeric(as.factor(mushroomDataKNN$has.ring))
mushroomDataKNN$ring.type <- as.numeric(as.factor(mushroomDataKNN$ring.type))
mushroomDataKNN$spore.print.color <- as.numeric(as.factor(mushroomDataKNN$spore.print.color))
mushroomDataKNN$habitat <- as.numeric(as.factor(mushroomDataKNN$habitat))
mushroomDataKNN$season <- as.numeric(as.factor(mushroomDataKNN$season))

class = mushroomDataKNN$class
mushroomDataKNN = subset(mushroomDataKNN, select = -c(class) )

for(i in 1:ncol(mushroomDataKNN)){
  mushroomDataKNN[,i] = (mushroomDataKNN[,i] - mean(mushroomDataKNN[,i]))/(sd(mushroomDataKNN[,i]))
}

mushroomDataKNN$class = class

misKNN = c(10)
inClass = c(10)

for (i in 1:10) {
    
  num_samples = dim(mushroomDataKNN)[1]
  sampling.rate = 0.8
  training <- sample(1:num_samples, sampling.rate * num_samples, replace=FALSE)
  trainingSet <- subset(mushroomDataKNN[training, ])
  testing <- setdiff(1:num_samples, training)
  testingSet <- subset(mushroomDataKNN[testing, ])
    
  trainingfeaturesKNN <- subset(trainingSet, select=c(-class))
  traininglabelsKNN <- trainingSet$class
  testingfeaturesKNN <- subset(testingSet, select=c(-class))
  
  predictedLabelsKNN = knn(trainingfeaturesKNN, testingfeaturesKNN,traininglabelsKNN,k=i)
  sizeTestSetKNN = dim(testingSet)[1]
  error = sum(predictedLabelsKNN != testingSet$class)
  misRateKNN=error/sizeTestSetKNN
  misKNN[i]=misRateKNN
  
  inClass[i] = sum(predictedLabelsKNN != testingSet$class & testingSet$class == "e" )
  
}
inClass
min(inClass)
BestK = which(misKNN == min(misKNN))
LowestError = min(misKNN)
```

```{r}
plot(misKNN)
plot(inClass)
```

```{r}
#Bare cleaning and dat for SVM

mushroomDataKNN = read.csv("mushroom.csv", sep = ';')
mushroomDataKNN = mushroomDataKNN[c('class','ring.type', 'gill.attachment','gill.color', 'stem.surface', 'stem.height')]
mushroomDataKNN$class = ifelse(mushroomDataKNN$class == "e", 1, 0)
class = mushroomDataKNN$class
mushroomDataKNN = mushroomDataKNN[,-1]
library(dummy)
mushroomDataKNN = dummy(cbind.data.frame(mushroomDataKNN), p = "all", object = NULL, int = FALSE, verbose = FALSE)
mushroomDataKNN$class = class
```


```{r}

library(e1071)

num_samples = dim(mushroomDataKNN)[1]

sampling.rate = 0.8

trainingSVM = sample(1:num_samples, sampling.rate*num_samples, replace= FALSE)

trainingSetSVM = subset(mushroomDataKNN[trainingSVM, ])

testingSVM = setdiff(1:num_samples,trainingSVM)

testingSetSVM = subset(mushroomDataKNN[testingSVM, ])

svmModel <- svm(class~., data=trainingSetSVM, kernel="polynomial", cost = 1, scale = FALSE, type ="C-classification")
summary(svmModel)
predictedLabels <-predict(svmModel, testingSetSVM)
sizeTestSetSVM = dim(testingSetSVM)[1]
error = sum(predictedLabels != testingSetSVM$class)
print(error)
# misRateSVM=error/sizeTestSetSVM
# 
# inClass = sum(predictedLabelsKNN != testingSetSVM$class & testingSetSVM$class == 1 )
# 
# misRateSVM
# inClass
```



We wanted to check for the colinearity of diffe

-Wanted to run SVM
- Takes wayyyy too long to do the analysis of the SVM
- Instead we looked at an FAMD which is the same as a PCA only that it takes the mixed data
- IE it takes both quantitative and qualititave features
- we first tested the FAMD with 10, IE that it would scale down the dimensions to 10 from the 22 that we originally had
- We looked at a graph of diminishing variance gains to identify where the largest drop would be in variance
- we picked with 4 dimensions and reran the model
```{r}
library(FactoMineR)
mushroomFAMD = read.csv("mushroom.csv", sep = ';')

mushroom_FAMD = FAMD(mushroomFAMD, ncp = 10, axes = c(1,2))

summary(mushroom_FAMD)

```

```{r}
eig.val <- mushroom_FAMD$eig
barplot(eig.val[, 2], 
        names.arg = 1:nrow(eig.val), 
        main = "Variances Explained by Dimensions (%)",
        xlab = "Principal Dimensions",
        ylab = "Percentage of variances",
        col ="steelblue")
# Add connected line segments to the plot
lines(x = 1:nrow(eig.val), eig.val[, 2], 
      type = "b", pch = 19, col = "red")
```


