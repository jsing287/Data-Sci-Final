---
title: "Final Project"
author: "Eric Senatore"
date: "2022-11-22"
output: html_document
---

```{r}
mushroomData = read.csv("mushroom.csv", sep = ';')
head(mushroomData)

library (rpart)

AllErrors = c()
AllErrorsPruned = c()

num_samples = dim(mushroomData)[1]
sampling.rate = 0.8
training = sample(1:num_samples, sampling.rate*num_samples, replace= FALSE)
trainingSet = subset(mushroomData[training, ])
testing = setdiff(1:num_samples,training)
testingSet = subset(mushroomData[testing, ])
```

```{r}
decTreeModel = rpart(class~cap.diameter+cap.shape+cap.surface+cap.color+does.bruise.or.bleed+gill.attachment+gill.spacing+gill.color+stem.height+stem.width+stem.root+stem.surface+stem.color+has.ring+ring.type+spore.print.color+habitat+season,data=trainingSet)

plot(decTreeModel, margin=0.1)
text(decTreeModel)

plotcp(decTreeModel)

pruned_decTreeModel = prune(decTreeModel, cp=0.022)
plot (pruned_decTreeModel, margin=0.1)
text (pruned_decTreeModel)

predictedLabelsPrune = predict(pruned_decTreeModel, testingSet, type="class")
sizeTestSet2 = dim(testingSet) [1]
error = sum(predictedLabelsPrune != testingSet$class)
misclassification_rate = error/sizeTestSet2
```

```{r}
library(class)
mushroomDataKNN = read.csv("mushroom.csv", sep = ';')

mushroomDataKNN$cap.shape <- as.numeric(as.factor(mushroomDataKNN$cap.shape))
mushroomDataKNN$cap.surface <- as.numeric(as.factor(mushroomDataKNN$cap.surface))
mushroomDataKNN$cap.color <- as.numeric(as.factor(mushroomDataKNN$cap.color))
mushroomDataKNN$does.bruise.or.bleed <- as.numeric(as.factor(mushroomDataKNN$does.bruise.or.bleed))
mushroomDataKNN$gill.attachment <- as.numeric(as.factor(mushroomDataKNN$gill.attachment))
mushroomDataKNN$gill.spacing <- as.numeric(as.factor(mushroomDataKNN$gill.spacing))
mushroomDataKNN$gill.color <- as.numeric(as.factor(mushroomDataKNN$gill.color))
mushroomDataKNN$stem.root <- as.numeric(as.factor(mushroomDataKNN$stem.root))
mushroomDataKNN$stem.surface <- as.numeric(as.factor(mushroomDataKNN$stem.surface))
mushroomDataKNN$stem.color <- as.numeric(as.factor(mushroomDataKNN$stem.color))
mushroomDataKNN$veil.type <- as.numeric(as.factor(mushroomDataKNN$veil.type))
mushroomDataKNN$veil.color <- as.numeric(as.factor(mushroomDataKNN$veil.color))
mushroomDataKNN$has.ring <- as.numeric(as.factor(mushroomDataKNN$has.ring))
mushroomDataKNN$ring.type <- as.numeric(as.factor(mushroomDataKNN$ring.type))
mushroomDataKNN$spore.print.color <- as.numeric(as.factor(mushroomDataKNN$spore.print.color))
mushroomDataKNN$habitat <- as.numeric(as.factor(mushroomDataKNN$habitat))
mushroomDataKNN$season <- as.numeric(as.factor(mushroomDataKNN$season))

class = mushroomDataKNN$class
mushroomDataKNN = subset(mushroomDataKNN, select = -c(class) )

for(i in 1:ncol(mushroomDataKNN)){
  mushroomDataKNN[,i] = (mushroomDataKNN[,i] - mean(mushroomDataKNN[,i]))/(sd(mushroomDataKNN[,i]))
}

mushroomDataKNN$class = class

misKNN = c(300)
inClass = c(300)

for (i in 1:300) {
    
  num_samples = dim(mushroomDataKNN)[1]
  sampling.rate = 0.8
  training <- sample(1:num_samples, sampling.rate * num_samples, replace=FALSE)
  trainingSet <- subset(mushroomDataKNN[training, ])
  testing <- setdiff(1:num_samples, training)
  testingSet <- subset(mushroomDataKNN[testing, ])
    
  trainingfeaturesKNN <- subset(trainingSet, select=c(-class))
  traininglabelsKNN <- trainingSet$class
  testingfeaturesKNN <- subset(testingSet, select=c(-class))
  
  predictedLabelsKNN = knn(trainingfeaturesKNN, testingfeaturesKNN,traininglabelsKNN,k=i)
  sizeTestSetKNN = dim(testingSet)[1]
  error = sum(predictedLabelsKNN != testingSet$class)
  misRateKNN=error/sizeTestSetKNN
  misKNN[i]=misRateKNN
  
  inClass[i] = sum(predictedLabelsKNN != testingSet$class & testingSet$class == "e" )
  
}
inClass
min(inClass)
BestK = which(misKNN == min(misKNN))
LowestError = min(misKNN)

plot(misKNN)
```

```{r}
plot(misKNN)
plot(inClass)
```

